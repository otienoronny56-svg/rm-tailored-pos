<!DOCTYPE html>
<html>
<head>
    <title>Financial Overview - RM TAILORED</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { color: #dc143c; text-align: center; margin-bottom: 30px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #f8f8f8; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #dc143c; }
        .stat-number { font-size: 2em; font-weight: bold; color: #dc143c; }
        .stat-label { color: #666; margin-top: 5px; }
        .btn-back { background: #666; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f8f8; }
        .recent-orders { margin-top: 40px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š FINANCIAL OVERVIEW</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">â‚¦0</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">0</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">0</div>
                <div class="stat-label">Pending Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">â‚¦0</div>
                <div class="stat-label">This Month</div>
            </div>
        </div>

        <div class="recent-orders">
            <h3>ðŸ“‹ Recent Orders</h3>
            <div id="recentOrders">
                <p>Loading recent orders...</p>
            </div>
        </div>

        <button class="btn-back" onclick="goBack()">â¬… BACK TO DASHBOARD</button>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://jahrvqdxbdcnqnxuhewf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImphaHJ2cWR4YmRjbnFueHVoZXdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MDY4ODUsImV4cCI6MjA3ODI4Mjg4NX0._Q8_o41iN2_roejx67FvOQ8DlMApPdw0L3bmWhymgNc';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Load financial data when page loads
        document.addEventListener('DOMContentLoaded', loadFinancialData);

        async function loadFinancialData() {
            try {
                // Get all orders
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) throw error;

                displayRecentOrders(orders);
                updateFinancialStats(orders);
                
            } catch (error) {
                document.getElementById('recentOrders').innerHTML = '<p>Error loading orders: ' + error.message + '</p>';
            }
        }

        function displayRecentOrders(orders) {
            const container = document.getElementById('recentOrders');
            
            if (!orders || orders.length === 0) {
                container.innerHTML = '<p>No orders found.</p>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Order Type</th>
                            <th>Price</th>
                            <th>Due Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            orders.forEach(order => {
                const dueDate = new Date(order.due_date).toLocaleDateString();
                const price = order.price ? `â‚¦${order.price}` : 'Not set';
                
                html += `
                    <tr>
                        <td>${order.customer_name}</td>
                        <td>${order.order_type}</td>
                        <td>${price}</td>
                        <td>${dueDate}</td>
                        <td>${order.status}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateFinancialStats(orders) {
            const totalOrders = orders.length;
            const pendingOrders = orders.filter(order => order.status === 'pending').length;
            
            // Calculate total revenue
            const totalRevenue = orders.reduce((sum, order) => {
                return sum + (order.price || 0);
            }, 0);

            // Update the stat cards
            document.querySelectorAll('.stat-card')[0].querySelector('.stat-number').textContent = `â‚¦${totalRevenue}`;
            document.querySelectorAll('.stat-card')[1].querySelector('.stat-number').textContent = totalOrders;
            document.querySelectorAll('.stat-card')[2].querySelector('.stat-number').textContent = pendingOrders;
            document.querySelectorAll('.stat-card')[3].querySelector('.stat-number').textContent = `â‚¦${totalRevenue}`; // Same as total for now
        }

        function goBack() {
            window.location.href = 'admin-dashboard.html';
        }
    </script>
</body>
</html>